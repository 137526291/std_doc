=========================
工业以太网EtherCAT调试笔记
=========================


microchip的LAN9252方案特点
-------------------------
1. 集成phy， 2端口（一进一出） SPI或者8/16位8086总线
2. 狼狗狼狗疯了

软硬件准备
-------------------------
1. 主站是普通PC/工控计算机即可,网卡必须是英特尔支持IEEE1588 快速以太网的型号。例如I210AT/intel82575等
2. 下载倍福的twincat上位机TC + 微软的visual studio。新建tc工程 并为网卡安装twincat驱动。
3. 从站ESC(ECAT slave controller 以太网控制+收发器)选用microchip的LAN9252。
#. 从站是我们需要设计的，目标是MCU+LAN9252. 带2个RJ45网口。 上电并用网线对接好ECAT网口与从站网口。
#. 根据microchip的LAN9252评估板quick guide文档，用tc上位机扫描从站。
#. 选中出现的从站,给LAN92下载EEPROM固件（此处下载SPI接口的固件，这样MCU才能与LAN92使用spi通信读写。
#. 开始调试LAN9252的软硬件。此处需要下载倍福的SSC（从机协议栈代码）软件工具，用于生成ecat协议栈相关源码文件。
#. 根据microchip的评估板操作文档，将SSC生成对应LAN9252的代码（协议栈+spiDriver）后，集成到MCU开发环境。


软件调试
-------------------------
1. LAN92的内部寄存器分2种，直接寻址读写的和间接寻址读写。
2. MCU并不能通过总线接口直接访问LAN9252内部的EtherCAT内核寄存器，而是需要通过LAN9252提供的系统控制和状态寄存器CSR进行间接寻址。
3. 移植好主机接口读写后，还需要有个1ms的ecat定时器以及3个中断（IRQ sync0 sync1）支持。
4. 根据microchip的pic32例程里实现的INPUT OUTPUT PDO直接映射，使用主站和从站分别测试BOX1的输入输出即可。
5. 移植成功后 在主站twincat上位机 从站可以实现所有5个状态切换，且可以进入OP状态。否则会出现INIT_ERR错误。